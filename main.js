const fs = require('fs').promises;
const pfs = require('fs');
const prompt = require('prompt-sync')();
const template_files = [
  '/NDA.md',
  '/pentest-report.md',
  '/right-to-speak-to-law-enforcement.md',
  '/scope-of-work.md'
];
const pentester_name = prompt('Pentester Name: ');
const pentester_address = prompt('Pentester Address: ');
const pentester_city = prompt('Pentester City: ');
const pentester_state = prompt('Pentester State: ');
const pentester_zip = prompt('Pentester Zip: ');
const pentester_phone = prompt('Pentester phone: ');
const pentester_email = prompt('Pentester email: ');

const client_name = prompt('Client Name: ');
const client_address = prompt('Client Address: ');
const client_city = prompt('Client City: ');
const client_state = prompt('Client State: ');
const client_zip = prompt('Client Zip: ');
const client_phone = prompt('Client phone: ');
const client_email = prompt('Client email: ');
writeNDA()
async function writeNDA() {
  await replaceText(`.${template_files[0]}`, '.clients/NDA.md', /\[Name of Receiving Party\]/gm, pentester_name)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', 'Non-Disclosure Agreement (NDA) Template:', 'Non-Disclosure Agreement (NDA):')
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Receiving Address]', pentester_address)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Receiving City, State ZIP]', `${pentester_city}, ${pentester_state} ${pentester_zip}`)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Receiving Phone Number]', pentester_phone)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Receiving Email Address]', pentester_email)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Date]', new Date(Date.now()).toLocaleString().split(',')[0])
  await replaceText('.clients/NDA.md', '.clients/NDA.md', /\[Name of Disclosing Party]/gm, client_name)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Disclosing Address]', client_address)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Disclosing City, State ZIP]', `${client_city}, ${client_state} ${client_zip}`)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Disclosing Phone Number]', client_phone)
  await replaceText('.clients/NDA.md', '.clients/NDA.md', '[Disclosing Email Address]', client_email)
  console.log('NDA Created in .clients/NDA.md')
}
async function replaceText(someFile, outFile, search, replace) {
  // Below statements must be wrapped inside the 'async' function:
  const data = await fs.readFile(someFile, 'utf8');
  //const result = data.replace(/\[string to be replaced\]/g, 'replacement')
  const result = data.replace(search, replace);

  await pfs.writeFileSync(outFile, result);

}
